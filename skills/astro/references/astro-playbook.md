# Astro Playbook

## Table Of Contents
- Verification Snapshot
- Setup And Baseline
- Core APIs And Project Patterns
- Rendering Modes And Adapters
- Blog-Focused Pattern
- Publishing Integrations (RSS + Sitemap)
- Sources

## Verification Snapshot

Verified on 2026-02-15.

Observed package versions from npm registry:
- `astro`: `5.17.2`
- `@astrojs/mdx`: `4.3.13`
- `@astrojs/rss`: `4.0.15`
- `@astrojs/sitemap`: `3.7.0`

Docs pages fetched for this skill are generated by Astro `v5.16.6`, and the install flow uses `@latest`.

## Setup And Baseline

Recommended project bootstrap:

```bash
npm create astro@latest
```

Key prerequisites from docs:
- Node.js `v18.20.8`, `v20.3.0`, `v22.0.0` or higher.
- Node `v19` and `v21` are not supported.

Useful setup variants:
- Add integrations while creating project: `npm create astro@latest -- --add react --add partytown`
- Start from template: `npm create astro@latest -- --template <example-name>`

## Core APIs And Project Patterns

Content collections and content layer:
- Define collections in `src/content.config.ts` with `defineCollection()`.
- Use loaders from `astro/loaders` (`glob()`, `file()`).
- Query with `getCollection()`, `getEntry()`, `getEntries()`.
- Use `render()` to produce component output from entries.
- Use `reference()` for typed relationships across collections.

Recommended for maintainable content:
- Prefer collection schemas over untyped frontmatter.
- Filter drafts in collection queries.
- Keep URL strategy explicit for dynamic routes (`[id]` or `[...slug]` when slashes are present).

Images:
- Prefer local images in `src/` for optimization and bundling.
- Use `public/` only when no processing is desired.
- Use `<Image />` / `<Picture />` from `astro:assets` for optimized output.
- Always provide `alt` (required by Astro image components).
- Authorize remote image sources before transformation.

## Rendering Modes And Adapters

Default behavior:
- Astro prerenders routes statically by default.

On-demand rendering:
- Install an adapter for server runtime.
- Use `export const prerender = false` on routes/endpoints that must render on request.

Server-first mode:
- Set `output: 'server'` in `astro.config.*` to render all routes on demand by default.
- Opt back into prerender per route if needed.

## Blog-Focused Pattern

Treat this as a focused variant of the general Astro workflow:

1. Define a `blog` collection schema:
- Typical fields: `title`, `description`, `pubDate`, `draft`, `tags`, optional cover image fields.

2. Build listing pages from `getCollection('blog')`:
- Filter `draft !== true`.
- Sort descending by publish date.

3. Build post pages:
- Static flow: `getStaticPaths()` maps entries to params.
- SSR flow: read params and fetch with `getEntry()`.

4. Render entry content:
- Use `render(entry)` and include `Content` output in post templates.

5. Add feed and sitemap:
- RSS endpoint + sitemap integration for discoverability.

## Publishing Integrations (RSS + Sitemap)

RSS (`@astrojs/rss`):
- Create endpoint like `src/pages/rss.xml.js`.
- Import `rss` from `@astrojs/rss`.
- Ensure `site` is configured and pass `site: context.site`.
- Build `items` from collections or content imports.
- If project uses `trailingSlash: "never"`, set `trailingSlash: false` in `rss()`.

Sitemap (`@astrojs/sitemap`):
- Add via `astro add sitemap` or manual install + integration entry.
- Configure `site` in `astro.config.*` (required).
- Build output includes `sitemap-index.xml` and chunked sitemap files.
- Use integration options (`filter`, `customPages`, namespaces, etc.) when needed.

## Sources

- Astro Getting Started: https://docs.astro.build/en/getting-started/
- Install and setup: https://docs.astro.build/en/install-and-setup/
- Content collections guide: https://docs.astro.build/en/guides/content-collections/
- `astro:content` module reference: https://docs.astro.build/en/reference/modules/astro-content/
- Markdown content guide: https://docs.astro.build/en/guides/markdown-content/
- Images guide: https://docs.astro.build/en/guides/images/
- `astro:assets` reference: https://docs.astro.build/en/reference/modules/astro-assets/
- RSS recipe: https://docs.astro.build/en/recipes/rss/
- Sitemap integration: https://docs.astro.build/en/guides/integrations-guide/sitemap/
- On-demand rendering guide: https://docs.astro.build/en/guides/on-demand-rendering/
- Upgrade to v5 guide: https://docs.astro.build/en/guides/upgrade-to/v5/
- Astro 5.17 release post: https://astro.build/blog/astro-517/
- npm package versions:
  - https://www.npmjs.com/package/astro
  - https://www.npmjs.com/package/@astrojs/mdx
  - https://www.npmjs.com/package/@astrojs/rss
  - https://www.npmjs.com/package/@astrojs/sitemap
